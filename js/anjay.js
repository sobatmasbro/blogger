data:text/javascript;base64,KGZ1bmN0aW9uKCQpIHsNCg0KICAkLmZuLnRyYW5zcG9zZSA9IGZ1bmN0aW9uKG9wdGlvbnMpIHsNCiAgICB2YXIgb3B0cyA9ICQuZXh0ZW5kKHt9LCAkLmZuLnRyYW5zcG9zZS5kZWZhdWx0cywgb3B0aW9ucyk7DQogICAgDQogICAgdmFyIGN1cnJlbnRLZXkgPSBudWxsOw0KICAgIA0KICAgIHZhciBrZXlzID0gWw0KICAgICAgeyBuYW1lOiAnQWInLCAgdmFsdWU6IDAsICAgdHlwZTogJ0YnIH0sDQogICAgICB7IG5hbWU6ICdBJywgICB2YWx1ZTogMSwgICB0eXBlOiAnTicgfSwNCiAgICAgIHsgbmFtZTogJ0EjJywgIHZhbHVlOiAyLCAgIHR5cGU6ICdTJyB9LA0KICAgICAgeyBuYW1lOiAnQmInLCAgdmFsdWU6IDIsICAgdHlwZTogJ0YnIH0sDQogICAgICB7IG5hbWU6ICdCJywgICB2YWx1ZTogMywgICB0eXBlOiAnTicgfSwNCiAgICAgIHsgbmFtZTogJ0MnLCAgIHZhbHVlOiA0LCAgIHR5cGU6ICdOJyB9LA0KICAgICAgeyBuYW1lOiAnQyMnLCAgdmFsdWU6IDUsICAgdHlwZTogJ1MnIH0sDQogICAgICB7IG5hbWU6ICdEYicsICB2YWx1ZTogNSwgICB0eXBlOiAnRicgfSwNCiAgICAgIHsgbmFtZTogJ0QnLCAgIHZhbHVlOiA2LCAgIHR5cGU6ICdOJyB9LA0KICAgICAgeyBuYW1lOiAnRCMnLCAgdmFsdWU6IDcsICAgdHlwZTogJ1MnIH0sDQogICAgICB7IG5hbWU6ICdFYicsICB2YWx1ZTogNywgICB0eXBlOiAnRicgfSwNCiAgICAgIHsgbmFtZTogJ0UnLCAgIHZhbHVlOiA4LCAgIHR5cGU6ICdOJyB9LA0KICAgICAgeyBuYW1lOiAnRicsICAgdmFsdWU6IDksICAgdHlwZTogJ04nIH0sDQogICAgICB7IG5hbWU6ICdGIycsICB2YWx1ZTogMTAsICB0eXBlOiAnUycgfSwNCiAgICAgIHsgbmFtZTogJ0diJywgIHZhbHVlOiAxMCwgIHR5cGU6ICdGJyB9LA0KICAgICAgeyBuYW1lOiAnRycsICAgdmFsdWU6IDExLCAgdHlwZTogJ04nIH0sDQogICAgICB7IG5hbWU6ICdHIycsICB2YWx1ZTogMCwgICB0eXBlOiAnUycgfQ0KICAgIF07DQogIA0KICAgIHZhciBnZXRLZXlCeU5hbWUgPSBmdW5jdGlvbiAobmFtZSkgew0KICAgICAgICBpZiAobmFtZS5jaGFyQXQobmFtZS5sZW5ndGgtMSkgPT0gIm0iKSB7DQogICAgICAgICAgbmFtZSA9IG5hbWUuc3Vic3RyaW5nKDAsIG5hbWUubGVuZ3RoLTEpOw0KICAgICAgICB9DQogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgaWYgKG5hbWUgPT0ga2V5c1tpXS5uYW1lKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGtleXNbaV07DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9Ow0KDQogICAgdmFyIGdldENob3JkUm9vdCA9IGZ1bmN0aW9uIChpbnB1dCkgew0KICAgICAgICBpZiAoaW5wdXQubGVuZ3RoID4gMSAmJiAoaW5wdXQuY2hhckF0KDEpID09ICJiIiB8fCBpbnB1dC5jaGFyQXQoMSkgPT0gIiMiKSkNCiAgICAgICAgICAgIHJldHVybiBpbnB1dC5zdWJzdHIoMCwgMik7DQogICAgICAgIGVsc2UNCiAgICAgICAgICAgIHJldHVybiBpbnB1dC5zdWJzdHIoMCwgMSk7DQogICAgfTsNCg0KICAgIHZhciBnZXROZXdLZXkgPSBmdW5jdGlvbiAob2xkS2V5LCBkZWx0YSwgdGFyZ2V0S2V5KSB7DQogICAgICAgIHZhciBrZXlWYWx1ZSA9IGdldEtleUJ5TmFtZShvbGRLZXkpLnZhbHVlICsgZGVsdGE7DQoNCiAgICAgICAgaWYgKGtleVZhbHVlID4gMTEpIHsNCiAgICAgICAgICAgIGtleVZhbHVlIC09IDEyOw0KICAgICAgICB9IGVsc2UgaWYgKGtleVZhbHVlIDwgMCkgew0KICAgICAgICAgICAga2V5VmFsdWUgKz0gMTI7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIHZhciBpPTA7DQogICAgICAgIGlmIChrZXlWYWx1ZSA9PSAwIHx8IGtleVZhbHVlID09IDIgfHwga2V5VmFsdWUgPT0gNSB8fCBrZXlWYWx1ZSA9PSA3IHx8IGtleVZhbHVlID09IDEwKSB7DQogICAgICAgICAgICAvLyBSZXR1cm4gdGhlIEZsYXQgb3IgU2hhcnAgS2V5DQogICAgICAgICAgICBzd2l0Y2godGFyZ2V0S2V5Lm5hbWUpIHsNCiAgICAgICAgICAgICAgY2FzZSAiQSI6DQogICAgICAgICAgICAgIGNhc2UgIkEjIjoNCiAgICAgICAgICAgICAgY2FzZSAiQiI6DQogICAgICAgICAgICAgIGNhc2UgIkMiOg0KICAgICAgICAgICAgICBjYXNlICJDIyI6DQogICAgICAgICAgICAgIGNhc2UgIkQiOg0KICAgICAgICAgICAgICBjYXNlICJEIyI6DQogICAgICAgICAgICAgIGNhc2UgIkUiOg0KICAgICAgICAgICAgICBjYXNlICJGIyI6DQogICAgICAgICAgICAgIGNhc2UgIkciOg0KICAgICAgICAgICAgICBjYXNlICJHIyI6DQogICAgICAgICAgICAgICAgICBmb3IgKDtpPGtleXMubGVuZ3RoO2krKykgew0KICAgICAgICAgICAgICAgICAgICBpZiAoa2V5c1tpXS52YWx1ZSA9PSBrZXlWYWx1ZSAmJiBrZXlzW2ldLnR5cGUgPT0gIlMiKSB7DQogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGtleXNbaV07DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgICAgICAgIGZvciAoO2k8a2V5cy5sZW5ndGg7aSsrKSB7DQogICAgICAgICAgICAgICAgICAgIGlmIChrZXlzW2ldLnZhbHVlID09IGtleVZhbHVlICYmIGtleXNbaV0udHlwZSA9PSAiRiIpIHsNCiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4ga2V5c1tpXTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgLy8gUmV0dXJuIHRoZSBOYXR1cmFsIEtleQ0KICAgICAgICAgICAgZm9yICg7aTxrZXlzLmxlbmd0aDtpKyspIHsNCiAgICAgICAgICAgICAgaWYgKGtleXNbaV0udmFsdWUgPT0ga2V5VmFsdWUpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4ga2V5c1tpXTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfTsNCg0KICAgIHZhciBnZXRDaG9yZFR5cGUgPSBmdW5jdGlvbiAoa2V5KSB7DQogICAgICAgIHN3aXRjaCAoa2V5LmNoYXJBdChrZXkubGVuZ3RoIC0gMSkpIHsNCiAgICAgICAgICAgIGNhc2UgImIiOg0KICAgICAgICAgICAgICAgIHJldHVybiAiRiI7DQogICAgICAgICAgICBjYXNlICIjIjoNCiAgICAgICAgICAgICAgICByZXR1cm4gIlMiOw0KICAgICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgICAgcmV0dXJuICJOIjsNCiAgICAgICAgfQ0KICAgIH07DQoNCiAgICB2YXIgZ2V0RGVsdGEgPSBmdW5jdGlvbiAob2xkSW5kZXgsIG5ld0luZGV4KSB7DQogICAgICAgIGlmIChvbGRJbmRleCA+IG5ld0luZGV4KQ0KICAgICAgICAgICAgcmV0dXJuIDAgLSAob2xkSW5kZXggLSBuZXdJbmRleCk7DQogICAgICAgIGVsc2UgaWYgKG9sZEluZGV4IDwgbmV3SW5kZXgpDQogICAgICAgICAgICByZXR1cm4gMCArIChuZXdJbmRleCAtIG9sZEluZGV4KTsNCiAgICAgICAgZWxzZQ0KICAgICAgICAgICAgcmV0dXJuIDA7DQogICAgfTsNCg0KICAgIHZhciB0cmFuc3Bvc2VTb25nID0gZnVuY3Rpb24gKHRhcmdldCwga2V5KSB7DQogICAgICAgIHZhciBuZXdLZXkgPSBnZXRLZXlCeU5hbWUoa2V5KTsNCg0KICAgICAgICBpZiAoY3VycmVudEtleS5uYW1lID09IG5ld0tleS5uYW1lKSB7DQogICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQoNCiAgICAgICAgdmFyIGRlbHRhID0gZ2V0RGVsdGEoY3VycmVudEtleS52YWx1ZSwgbmV3S2V5LnZhbHVlKTsNCiAgICAgICAgDQogICAgICAgICQoInNwYW4uY2hvcmQtb3V0cHV0IiwgdGFyZ2V0KS5lYWNoKGZ1bmN0aW9uIChpLCBlbCkgew0KICAgICAgICAgICAgdHJhbnNwb3NlQ2hvcmQoZWwsIGRlbHRhLCBuZXdLZXkpOw0KICAgICAgICB9KTsNCiAgICAgICAgDQogICAgICAgIGN1cnJlbnRLZXkgPSBuZXdLZXk7DQogICAgfTsNCg0KICAgIHZhciB0cmFuc3Bvc2VDaG9yZCA9IGZ1bmN0aW9uIChzZWxlY3RvciwgZGVsdGEsIHRhcmdldEtleSkgew0KICAgICAgICB2YXIgZWwgPSAkKHNlbGVjdG9yKTsNCiAgICAgICAgdmFyIG9sZENob3JkID0gZWwudGV4dCgpOw0KICAgICAgICB2YXIgb2xkQ2hvcmRSb290ID0gZ2V0Q2hvcmRSb290KG9sZENob3JkKTsNCiAgICAgICAgdmFyIG5ld0Nob3JkUm9vdCA9IGdldE5ld0tleShvbGRDaG9yZFJvb3QsIGRlbHRhLCB0YXJnZXRLZXkpOw0KICAgICAgICB2YXIgbmV3Q2hvcmQgPSBuZXdDaG9yZFJvb3QubmFtZSArIG9sZENob3JkLnN1YnN0cihvbGRDaG9yZFJvb3QubGVuZ3RoKTsNCiAgICAgICAgZWwudGV4dChuZXdDaG9yZCk7DQoNCiAgICAgICAgdmFyIHNpYiA9IGVsWzBdLm5leHRTaWJsaW5nOw0KICAgICAgICBpZiAoc2liICYmIHNpYi5ub2RlVHlwZSA9PSAzICYmIHNpYi5ub2RlVmFsdWUubGVuZ3RoID4gMCAmJiBzaWIubm9kZVZhbHVlLmNoYXJBdCgwKSAhPSAiLyIpIHsNCiAgICAgICAgICAgIHZhciB3c0xlbmd0aCA9IGdldE5ld1doaXRlU3BhY2VMZW5ndGgob2xkQ2hvcmQubGVuZ3RoLCBuZXdDaG9yZC5sZW5ndGgsIHNpYi5ub2RlVmFsdWUubGVuZ3RoKTsNCiAgICAgICAgICAgIHNpYi5ub2RlVmFsdWUgPSBtYWtlU3RyaW5nKCIgIiwgd3NMZW5ndGgpOw0KICAgICAgICB9DQogICAgfTsNCg0KICAgIHZhciBnZXROZXdXaGl0ZVNwYWNlTGVuZ3RoID0gZnVuY3Rpb24gKGEsIGIsIGMpIHsNCiAgICAgICAgaWYgKGEgPiBiKQ0KICAgICAgICAgICAgcmV0dXJuIChjICsgKGEgLSBiKSk7DQogICAgICAgIGVsc2UgaWYgKGEgPCBiKQ0KICAgICAgICAgICAgcmV0dXJuIChjIC0gKGIgLSBhKSk7DQogICAgICAgIGVsc2UNCiAgICAgICAgICAgIHJldHVybiBjOw0KICAgIH07DQoNCiAgICB2YXIgbWFrZVN0cmluZyA9IGZ1bmN0aW9uIChzLCByZXBlYXQpIHsNCiAgICAgICAgdmFyIG8gPSBbXTsNCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCByZXBlYXQ7IGkrKykgby5wdXNoKHMpOw0KICAgICAgICByZXR1cm4gby5qb2luKCIiKTsNCiAgICB9DQogICAgDQogICAgDQogICAgdmFyIGlzQ2hvcmRMaW5lID0gZnVuY3Rpb24gKGlucHV0KSB7DQogICAgICAgIHZhciB0b2tlbnMgPSBpbnB1dC5yZXBsYWNlKC9ccysvLCAiICIpLnNwbGl0KCIgIik7DQoNCiAgICAgICAgLy8gVHJ5IHRvIGZpbmQgdG9rZW5zIHRoYXQgYXJlbid0IGNob3Jkcw0KICAgICAgICAvLyBpZiB3ZSBmaW5kIG9uZSB3ZSBrbm93IHRoYXQgdGhpcyBsaW5lIGlzIG5vdCBhICdjaG9yZCcgbGluZS4NCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0b2tlbnMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgIGlmICghJC50cmltKHRva2Vuc1tpXSkubGVuZ3RoID09IDAgJiYgIXRva2Vuc1tpXS5tYXRjaChvcHRzLmNob3JkUmVnZXgpKQ0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9Ow0KICAgIA0KICAgIHZhciB3cmFwQ2hvcmRzID0gZnVuY3Rpb24gKGlucHV0KSB7DQogICAgICAgIHJldHVybiBpbnB1dC5yZXBsYWNlKG9wdHMuY2hvcmRSZXBsYWNlUmVnZXgsICI8c3BhbiBjbGFzcz0nY2hvcmQtb3V0cHV0Jz4kMTwvc3Bhbj4iKTsNCiAgICB9Ow0KICAgIA0KICAgIA0KICAgIHJldHVybiAkKHRoaXMpLmVhY2goZnVuY3Rpb24oKSB7DQogICAgDQogICAgICB2YXIgc3RhcnRLZXkgPSAkKHRoaXMpLmF0dHIoImRhdGEta2V5Iik7DQogICAgICBpZiAoIXN0YXJ0S2V5IHx8ICQudHJpbShzdGFydEtleSkgPT0gIiIpIHsNCiAgICAgICAgc3RhcnRLZXkgPSBvcHRzLmtleTsNCiAgICAgIH0NCg0KICAgICAgaWYgKCFzdGFydEtleSB8fCAkLnRyaW0oc3RhcnRLZXkpID09ICIiKSB7DQogICAgICAgIHRocm93KCJTdGFydGluZyBrZXkgbm90IGRlZmluZWQuIik7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgfQ0KICAgICAgDQogICAgICBjdXJyZW50S2V5ID0gZ2V0S2V5QnlOYW1lKHN0YXJ0S2V5KTsNCg0KICAgICAgLy8gQnVpbGQgdHJhbnBvc2UgbGlua3MgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KICAgICAgdmFyIGtleUxpbmtzID0gW107DQogICAgICAkKGtleXMpLmVhY2goZnVuY3Rpb24oaSwga2V5KSB7DQogICAgICAgICAgaWYgKGN1cnJlbnRLZXkubmFtZSA9PSBrZXkubmFtZSkNCiAgICAgICAgICAgICAga2V5TGlua3MucHVzaCgiPGEgaHJlZj0nIycgY2xhc3M9J3NlbGVjdGVkJz4iICsga2V5Lm5hbWUgKyAiPC9hPiIpOw0KICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAga2V5TGlua3MucHVzaCgiPGEgaHJlZj0nIyc+IiArIGtleS5uYW1lICsgIjwvYT4iKTsNCiAgICAgIH0pOw0KDQoNCiAgICAgIHZhciAkdGhpcyA9ICQodGhpcyk7DQogICAgICB2YXIga2V5c0h0bWwgPSAkKCI8ZGl2IGNsYXNzPSdrdW5jaS1zb2JhdG1hc2Jybyc+PC9kaXY+Iik7DQogICAgICBrZXlzSHRtbC5odG1sKGtleUxpbmtzLmpvaW4oIiIpKTsNCiAgICAgICQoImEiLCBrZXlzSHRtbCkuY2xpY2soZnVuY3Rpb24oZSkgew0KICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsNCiAgICAgICAgICB0cmFuc3Bvc2VTb25nKCR0aGlzLCAkKHRoaXMpLnRleHQoKSk7DQogICAgICAgICAgJCgiLmt1bmNpLXNvYmF0bWFzYnJvIGEiKS5yZW1vdmVDbGFzcygic2VsZWN0ZWQiKTsNCiAgICAgICAgICAkKHRoaXMpLmFkZENsYXNzKCJzZWxlY3RlZCIpOw0KICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgIH0pOw0KICAgICAgDQogICAgICAkKHRoaXMpLmJlZm9yZShrZXlzSHRtbCk7DQoNCiAgICAgIHZhciBvdXRwdXQgPSBbXTsNCiAgICAgIHZhciBsaW5lcyA9ICQodGhpcykudGV4dCgpLnNwbGl0KC9cclxufFxuL2cpOw0KICAgICAgdmFyIGxpbmUsIHRtcCA9ICIiOw0KDQogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpbmVzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgbGluZSA9IGxpbmVzW2ldOw0KDQogICAgICAgICAgaWYgKGlzQ2hvcmRMaW5lKGxpbmUpKQ0KICAgICAgICAgICAgICBvdXRwdXQucHVzaCgiPHNwYW4+IiArIHdyYXBDaG9yZHMobGluZSkgKyAiPC9zcGFuPiIpOw0KICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgb3V0cHV0LnB1c2goIjxzcGFuPiIgKyBsaW5lICsgIjwvc3Bhbj4iKTsNCiAgICAgIH07DQoNCiAgICAgICQodGhpcykuaHRtbChvdXRwdXQuam9pbigiXG4iKSk7DQogICAgfSk7DQogIH07DQoNCg0KICAkLmZuLnRyYW5zcG9zZS5kZWZhdWx0cyA9IHsNCiAgICBjaG9yZFJlZ2V4OiAvXltBLUddW2JcI10/KDJ8NHw1fDZ8N3w5fDExfDEzfDZcLzl8N1wtNXw3XC05fDdcIzV8N1wjOXw3XCs1fDdcKzl8YjV8IzV8Izl8N2I1fDdiOXw3c3VzMnw3c3VzNHxhZGQyfGFkZDR8YWRkOXxhdWd8ZGltfGRpbTd8bVwvbWFqN3xtNnxtN3xtN2I1fG05fG0xMXxtMTN8bWFqN3xtYWo5fG1hajExfG1hajEzfG1iNXxtfHN1c3xzdXMyfHN1czQpKihcL1tBLUddW2JcI10qKSokLywNCmNob3JkUmVwbGFjZVJlZ2V4OiAvKFtBLUddW2JcI10/KDJ8NHw1fDZ8N3w5fDExfDEzfDZcLzl8N1wtNXw3XC05fDdcIzV8N1wjOXw3XCs1fDdcKzl8YjV8IzV8Izl8N2I1fDdiOXw3c3VzMnw3c3VzNHxhZGQyfGFkZDR8YWRkOXxhdWd8ZGltfGRpbTd8bVwvbWFqN3xtNnxtN3xtN2I1fG05fG0xMXxtMTN8bWFqN3xtYWo5fG1hajExfG1hajEzfG1iNXxtfHN1c3xzdXMyfHN1czQpKikvZw0KICB9Ow0KDQp9KShqUXVlcnkpOw0KICAgICQoZnVuY3Rpb24oKSB7DQogICAgICQoIi5PdXRwdXRDaG9yZE1hc2JybyIpLnRyYW5zcG9zZSgpOw0KICAgIH0pOw0KICA8L3NjcmlwdD4NCiAgPHNjcmlwdD4NCg0KICAgICAgZnVuY3Rpb24gVHJhbnNwb3NlQ2hvcmQoKSB7DQoNCiAgICBpZiAoJC50cmltKCQoInRleHRhcmVhI3RyYW5zcG9zZXNvYmF0bWFzYnJvIikudmFsKCkpICE9ICIiKSB7DQogICAgICAgIHZhciBoYWhhID0gJCgidGV4dGFyZWEjdHJhbnNwb3Nlc29iYXRtYXNicm8iKS52YWwoKTsNCiAgICB9DQogDQogdmFyIHN0cjIgPSAiPHByZSBkYXRhLWtleT0nQycgY2xhc3M9J091dHB1dENob3JkTWFzYnJvJz4iOw0KIHZhciBzdHIzID0gIjwvcHJlPiI7DQogDQogdmFyIHJlcyA9IHN0cjIgKyBoYWhhICsgc3RyMzsNCg0KICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJUcmFuc3Bvc2VDaG9yZFNvYmF0TWFzYnJvIikuaW5uZXJIVE1MID0gcmVzOw0KICQoIi5PdXRwdXRDaG9yZE1hc2JybyIpLnRyYW5zcG9zZSgpOw0KfQ==
